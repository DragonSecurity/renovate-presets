{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":semanticCommits",
    ":semanticCommitTypeAll(chore)",
    ":timezone(Europe/Dublin)",
    "helpers:pinGitHubActionDigests",
    "docker:pinDigests",
    ":pinDevDependencies"
  ],
  "rebaseWhen": "auto",
  "recreateWhen": "auto",
  "recreateClosed": true,
  "prNotPendingHours": 12,
  "pruneStaleBranches": true,
  "rollbackPrs": true,
  "rangeStrategy": "bump",
  "dependencyDashboard": true,
  "dependencyDashboardAutoclose": true,
  "labels": ["dependencies"],
  "prConcurrentLimit": 20,
  "prHourlyLimit": 10,
  "platformAutomerge": false,
  "automergeStrategy": "squash",
  "separateMinorPatch": true,
  "separateMultipleMajor": true,
  "separateMultipleMinor": true,
  "lockFileMaintenance": {
    "enabled": true,
    "automerge": true
  },
  "vulnerabilityAlerts": {
    "enabled": true,
    "automerge": true,
    "addLabels": ["security"]
  },
  "osvVulnerabilityAlerts": {
    "enabled": true,
    "automerge": true
  },
  "packageRules": [
    {
      "description": "Instant, no-PR updates for safest classes",
      "matchUpdateTypes": ["patch", "pin", "digest", "lockFileMaintenance"],
      "automerge": true,
      "automergeType": "branch"
    },
    {
      "description": "Minor updates: PR-based but merge immediately (skip waiting for CI)",
      "matchUpdateTypes": ["minor"],
      "automerge": true,
      "automergeType": "pr",
      "ignoreTests": true
    },
    {
      "description": "Go tidy after updates",
      "matchManagers": ["gomod"],
      "postUpdateOptions": ["gomodTidy"]
    },
    {
      "description": "GitHub Actions patch/minor allowed (Fridays AM)",
      "matchManagers": ["github-actions"],
      "matchUpdateTypes": ["patch", "minor"],
      "automerge": true,
      "automergeType": "pr",
      "ignoreTests": true,
      "groupName": "GitHub Actions"
    },
    {
      "description": "Group JS prod deps",
      "matchManagers": ["npm", "pnpm", "yarn"],
      "matchDepTypes": ["dependencies", "optionalDependencies"],
      "excludeUpdateTypes": ["major"],
      "groupName": "JS prod dependencies"
    },
    {
      "description": "Group JS dev deps",
      "matchManagers": ["npm", "pnpm", "yarn"],
      "matchDepTypes": ["devDependencies", "peerDependencies"],
      "excludeUpdateTypes": ["major"],
      "groupName": "JS dev dependencies"
    },
    {
      "description": "Group @types/* packages",
      "matchManagers": ["npm", "pnpm", "yarn"],
      "matchPackagePatterns": ["^@types/"],
      "excludeUpdateTypes": ["major"],
      "groupName": "TypeScript types"
    },
    {
      "description": "Group JS test tooling",
      "matchManagers": ["npm", "pnpm", "yarn"],
      "matchPackagePatterns": [
        "(?i)jest",
        "(?i)vitest",
        "^@testing-library/",
        "(?i)mocha",
        "(?i)chai",
        "(?i)playwright",
        "(?i)cypress"
      ],
      "excludeUpdateTypes": ["major"],
      "groupName": "JS test tools"
    },
    {
      "description": "Group Docker digests",
      "matchManagers": ["dockerfile", "docker-compose"],
      "matchUpdateTypes": ["digest"],
      "groupName": "Docker digests"
    },
    {
      "description": "Group Docker version bumps",
      "matchManagers": ["dockerfile", "docker-compose"],
      "matchUpdateTypes": ["minor", "patch"],
      "groupName": "Docker versions"
    },
    {
      "description": "Group Go modules",
      "matchManagers": ["gomod"],
      "excludeUpdateTypes": ["major"],
      "groupName": "Go modules"
    },
    {
      "description": "JS minors: optional cool-down; remove if you want truly instant",
      "matchManagers": ["npm", "pnpm", "yarn"],
      "matchUpdateTypes": ["minor"],
      "minimumReleaseAge": "3 days"
    },
    {
      "description": "Route ALL major updates to a monthly upgrade day",
      "matchUpdateTypes": ["major"],
      "automerge": false,
      "draftPR": false,
      "prPriority": 2,
      "groupName": "Upgrade (majors)",
    }
  ]
}
